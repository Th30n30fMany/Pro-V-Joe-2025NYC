# Network & Event Cheat Sheet

## CIDR and Subnet Mask Cheat Sheet

|CIDR|Subnet Mask|Total IPs|Usable Hosts|
|---|---|---|---|
|/8|255.0.0.0|16,777,216|16,777,214|
|/16|255.255.0.0|65,536|65,534|
|/20|255.255.240.0|4,096|4,094|
|/22|255.255.252.0|1,024|1,022|
|/24|255.255.255.0|256|254|
|/25|255.255.255.128|128|126|
|/26|255.255.255.192|64|62|
|/27|255.255.255.224|32|30|
|/28|255.255.255.240|16|14|
|/29|255.255.255.248|8|6|
|/30|255.255.255.252|4|2|

- Usable hosts formula: usable = 2^(32 - prefix) - 2.
    
- /32 is single-host; /31 is commonly used for point-to-point links in modern routing.
    

## Quick CIDR Examples

- 10.0.0.0/24 → range 10.0.0.0–10.0.0.255; usable 10.0.0.1–10.0.0.254.
    
- 192.168.1.0/28 → range 192.168.1.0–192.168.1.15; usable 192.168.1.1–192.168.1.14.
    
- Network = lowest IP in block; Broadcast = highest IP in block.
    

## Top Nmap Ports and Common Services

|Port|Proto|Common Service|
|---|---|---|
|22|TCP|ssh|
|23|TCP|telnet|
|53|TCP/UDP|dns|
|80|TCP|http|
|88|TCP/UDP|kerberos|
|139|TCP|netbios-ssn|
|143|TCP|imap|
|161|UDP|snmp|
|389|TCP/UDP|ldap|
|443|TCP|https|
|445|TCP|microsoft-ds|
|3306|TCP|mysql|
|3389|TCP|rdp|
|5432|TCP|postgresql|
|5900|TCP|vnc|
|8080|TCP|http-alt|

- Use `--top-ports N` to scan the most common ports (typical values: 100, 200, 1000).
    

## Nmap Quick Reference Commands

### Handy Nmap Flags and When to Use Them

- `-sn` : host discovery only, no port scan.
    
- `-sV` : service/version detection.
    
- `-p-` : scan all TCP ports.
    
- `-sU` : UDP scan.
    
- `-T<0-5>` : timing template, `-T4` is aggressive but balanced.
    
- `-A` : OS detection, scripts, traceroute.
    
- `-oN` `-oX` `-oG` : normal, XML, grepable outputs.
    
- `-iL <file>` : read targets from file.
    
- `--top-ports <n>` : scan top n most common ports.
    
- `--open` : show only hosts with open ports.
    

### Practical Event Tips

- Save discovery and service outputs to a forensics directory immediately.
    
- Prefer incremental scanning: host discovery first, then targeted service scans.
    
- Use `-T4` for speed but drop to `-T3` if scans destabilize services.
    
- Capture traffic at choke points instead of on every host to reduce overhead.
    
- Always create a baseline snapshot before making changes and store checksums for later comparison.

- Ping sweep hosts in CIDR
    

bash

```
nmap -sn -PE -T4 10.1.0.0/24 -oG discovery.gnmap
```

- Top ports service scan
    

bash

```
nmap -sV -T4 --top-ports 200 10.1.0.0/24 -oN services.txt
```

- Full TCP port scan
    

bash

```
nmap -p- -sV -T4 10.1.10.5 -oN full_tcp.txt
```

- Aggressive OS and script scan
    

bash

```
nmap -A -T4 10.1.10.5 -oN aggressive.txt
```

- Save XML and grepable
    

bash

```
nmap -oX out.xml -oG out.gnmap 10.1.10.0/24
```

- Scan targets from file
    

bash

```
nmap -iL targets.txt --top-ports 200 -oN multi.txt
```

- UDP top ports (noisy and slow)
    

bash

```
nmap -sU --top-ports 50 -T4 10.1.0.0/24 -oN udp.txt
```

Handy flags: `-sn` (discovery), `-sV` (service detection), `-p-` (all TCP ports), `-sU` (UDP), `-T<0-5>` (timing), `-A` (aggressive), `--open` (show only hosts with open ports).



## Useful Linux Networking Commands

- Show listening sockets and processes
    

bash

```
ss -tunlp
```

- Show established connections
    

bash

```
ss -t state established
```

- Show IP addresses and routes
    

bash

```
ip -4 addr show
ip route show
```

- ARP table
    

bash

```
arp -a
```

- Capture packets rotating files (100MB each)
    

bash

```
tcpdump -i eth0 -w /var/pcap/cap-%Y%m%d%H%M.pcap -C 100
```

- Read pcap and show top external IPs
    

bash

```
tshark -r capture.pcap -T fields -e ip.dst | sort | uniq -c | sort -nr | head
```

- Extract HTTP requests from pcap
    

bash

```
tshark -r capture.pcap -Y "http.request" -T fields -e http.host -e http.request.uri
```

- DNS query troubleshooting
    

bash

```
dig @10.254.100.3 tokenid.canary.local +short
tcpdump -i eth0 -n -s0 -vvv port 53
```

- Quick banner grab
    

bash

```
timeout 2 bash -c "echo QUIT | nc -w 2 10.1.10.5 25"
```

## Network Triage Commands

- Top talkers (source IPs) from pcap
    

bash

```
tshark -r capture.pcap -T fields -e ip.src | sort | uniq -c | sort -nr | head
```

- Summarize connections (Zeek-style)
    

bash

```
tshark -r capture.pcap -q -z conv,ip
```

- Find periodic beaconing destinations
    

bash

```
tshark -r capture.pcap -T fields -e frame.time_epoch -e ip.dst | awk '{print $2}' | uniq -c | sort -nr | head
```

- Show open files and sockets mapped to processes
    

bash

```
lsof -i -n -P
```

- Recent auth failures
    

bash

```
grep -i "failed password" /var/log/auth.log | tail -n 100
```

## Practical Event Tips

- Save discovery and service outputs to a dedicated forensics path immediately (e.g., /var/forensics/<type>_<ts>).
    
- Prefer incremental scanning: host discovery first, then targeted service scans against scoring hosts.
    
- Use `-T4` for speed; reduce to `-T3` if scans cause instability.
    
- Capture traffic at a choke point (mirror/TAP) rather than capturing on every host to reduce load.
    
- Always snapshot baseline before making changes and store checksums for comparison.